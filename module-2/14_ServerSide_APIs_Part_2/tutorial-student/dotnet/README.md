# Server-Side APIs: Part 2 Tutorial (C#)

In this tutorial, you'll continue working on an application that uses Tech Elevator Locations as the data model. You'll add the ability to update and delete a location as well as perform data validation to inform the client of any problems.

## Step One: Open solution and explore starting code

Open `Locations.sln` and expand the folders in the Locations project.

### DAO

In the DAO folder, there's a `LocationDao.cs` class that provides data access code. To reduce complexity, a static `List` is used instead of a real database. Also, there are some methods in there that you'll call from the controller.

### Controller

In the previous tutorial, all of the locations were created in the `LocationsController`'s constructor. For this tutorial, all of the data initialization and CRUD operations have been moved to the `LocationDao.cs` class. A DAO instance is provided to the controller's constructor at runtime by the ASP.NET framework using Dependency Injection:

```csharp
public class LocationsController : ControllerBase
{
    private readonly ILocationDao dao;

    public LocationsController(ILocationDao locationsDao)
    {
        dao = locationsDao;
    }
}
```

The `Get()` method has also been slightly modified for you. If the DAO can find the location by the ID, it returns a `200 (OK)` status code. If that location doesn't exist, it returns a status code of `404 (NotFound)`:

```csharp
[HttpGet("{id}")]
public ActionResult<Location> Get(int id)
{
    Location location = dao.Get(id);
    if (location != null)
    {
        return Ok(location);
    }
    else
    {
        return NotFound("Location does not exist");
    }
}
```

You'll have the chance to do something similar later in this tutorial when you create the `Update()` method.

## Step Two: Run your project

Now that you've set up your project in Visual Studio and reviewed the starting code, run it to make sure everything works. It's best to make sure the application runs before adding anything new to it.

## Step Three: Add Location data validation

In the previous tutorial, there was some basic validation in the `Add()` method of the controller. If the location wasn't null, you'd add it to the list of locations:

```csharp
[HttpPost]
public Location Add(Location location)
{
    if (location != null)
    {
        Location returnLocation = dao.Create(location);
        return returnLocation;
    }
    return null;
}
```

>Note: The `locations.Add(location);` call has been replaced with a call to the DAO to add a location.

What happens if the location isn't null but is missing information? For locations, you want all these fields to be required, not blank:

- Name
- Address
- City
- State
- Zip

If you open `Location.cs`, you'll see the list of properties for this class. Before looking at the answer below, add the `[Required]` attribute for each required property:

```csharp
public class Location
{
    public int? Id { get; set; }

    public string Name { get; set; }

    public string Address { get; set; }

    public string City { get; set; }

    public string State { get; set; }

    public string Zip { get; set; }

    // ...

}
```

> The ID isn't required because it's generated by the `LocationDao` class.

Next, add a custom message by setting the `ErrorMessage` parameter of the `[Required]` attribute. Remember that adding custom messages helps the client understand what property failed data validation:

```csharp
public class Location
{
    public int? Id { get; set; }
    [Required(ErrorMessage = "The field Name is required.")]
    public string Name { get; set; }
    [Required(ErrorMessage = "The field Address is required.")]
    public string Address { get; set; }
    [Required(ErrorMessage = "The field City is required.")]
    public string City { get; set; }
    [Required(ErrorMessage = "The field State is required.")]
    public string State { get; set; }
    [Required(ErrorMessage = "The field Zip is required.")]
    public string Zip { get; set; }

    // ...

}
```

After you've defined validation rules on your model, you can declare a `Location` argument in any of your methods. If an object doesn't pass validation, .NET returns a `400 (BadRequest)` status automatically. You can remove the null check on `location` now:

```csharp
[HttpPost]
public Location Add(Location location)
{
    Location returnLocation = dao.Create(location);
    return returnLocation;
}
```

Feel free to test the `Add()` method in Postman. If you send an object with an empty string for `Name`, do you get the proper error message back?

## Step Four: Return proper status code for `Add()` method

Now that you have data validation in place, there's one more change you need to make to the `Add()` method. Currently, it returns the `Location` object. You now know how to return the correct status code, so you'll want to do that here.

If a new location is created, you must send back the status code `201 (Created)`. To do this, you'll change the return type to `ActionResult<Location>` instead of `Location`. When you return the `Created()` `ActionResult`, you'll send back the location of the new resource—that is, the URL—along with the resource itself:

```csharp
[HttpPost]
public ActionResult<Location> Add(Location location)
{
    Location returnLocation = dao.Create(location);
    return Created($"/locations/{returnLocation.Id}", returnLocation);
}
```

## Step Five: Update an existing location

To update an existing location, you need to create a new controller method that responds to the `PUT` request method. A client would specify the URL to a specific location, like `locations/1`, and send the JSON data that included the updated location. Using the ID in the URL, you can look up the existing location and update its data.

In `LocationController`, create a new method called `Update()`:

```csharp
[HttpPut("{id}")]
public ActionResult<Location> Update(int id, Location location)
{

}
```

The return type of this method is `ActionResult<Location>` so that you can handle several scenarios that might come up. First, what happens if the client tries to update a location that doesn't exist?

In that case, you want to return a status code of `404 (NotFound)`:

```csharp
public ActionResult<Location> Update(int id, Location location)
{
    Location existingLocation = dao.Get(id);
    if (existingLocation == null)
    {
        return NotFound("Location does not exist");
    }
}
```

Next, if you know the ID is a valid one, you can call the DAO to update the location and get the updated location back. You can use the result as an argument to the `Ok()` `ActionResult`:

```csharp
[HttpPut("{id}")]
public ActionResult<Location> Update(int id, Location location)
{
    Location existingLocation = dao.Get(id);
    if (existingLocation == null)
    {
        return NotFound("Location does not exist");
    }

    Location result = dao.Update(id, location);
    return Ok(result);
}
```

You can test this by running a `PUT` request in Postman. If you wanted to update the Tech Elevator Cleveland location, the path would be `http://localhost:8080/locations/1`. Make sure to change the request method to `PUT` and the `Content-Type` to `application/json`. You can send the following object to change the title:

```js
{
    "id": 1,
    "name": "THIS IS A NEW TITLE",
    "address": "7100 Euclid Ave #14",
    "city": "Cleveland",
    "state": "OH",
    "zip": "44103"
}
```

If you try updating a location that doesn't exist, like `/locations/99`, what happens? If you try changing the name to an empty string, what happens?

> Don't worry: the changes are only stored in memory, so you won't change this permanently. If you restart your application, you'll see the data has been reset.

## Step Six: Delete a location

Add a new `Delete()` method to your controller. Like `PUT`, `DELETE` targets the URL for a specific location. Unlike the update method, you won't return anything, so you'll want to make sure you return the status code `204 (No Content)`.

You also want to make sure you return a `404 Not Found` if the client tries to delete a location that doesn't exist:

```csharp
[HttpDelete("{id}")]
public ActionResult Delete(int id)
{
    Location location = dao.Get(id);
    if (location == null)
    {
        return NotFound("Location does not exist");
    }

    dao.Delete(id);
    return NoContent();
}
```

To test in Postman, run a `DELETE` on any of the existing locations. After running it and getting a successful `204 (No Content)` status back, run the `GET` to list all of the locations. You'll see that your location has been deleted. Like the update method, try sending a `DELETE` request to a location that doesn't exist and see what happens.

## Summary

In this tutorial, you learned:

- How to add validation attributes to your data model.
- How to send back the proper status codes to the client.
- How to create a method that updates a resource in your controller.
- How to create a method that deletes a resource in your controller.
